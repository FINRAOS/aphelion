{"version":3,"sources":["../src/module.js"],"names":["_","BasePanelCtrl","kbn","$","legend","FinraBarChartCtrl","$scope","$injector","$rootScope","$document","$compile","panelDefaults","show","values","tooltip","showAllDetails","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","legendTable","aliasColors","format","valueName","stack","yaxis","min","max","label","xaxis","decimals","dataspecType","$on","length","remove","defaults","panel","dd","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","addEditorTab","unitFormats","getUnitFormats","subItem","value","render","console","info","series","data","parseSeries","map","serie","i","dataReverse","color","colors","dataList","mapping","mappingHandler","dataHandler","stackable","stackedData","key","seriesData","each","curr","push","name","clone","item","reverse","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","scaledDecimals","axis","ticks","start","tickSize","Math","floor","v","Number","NaN","prev","datamaxBuffered","direction","round","datamax","options","customHeight","scope","elem","attrs","ctrl","firstRender","find","$tooltip","renderingCompleted","setElementHeight","height","row","isString","parseInt","replace","title","css","e","processOffsetHook","plot","gridMargin","left","right","addBarChart","width","size","plotCanvas","legendRight","plotCss","top","margin","position","hasRawData","event","pos","$drilldown","newScope","$new","seriesName","o","dataIndex","body","rawDataAlias","html","appendTo","$panelContainer","parents","backgroundColor","plotSeries","barLabels","barLabelsReverse","dataItem","flip","clickable","bars","align","fill","barWidth","zero","lineWidth","horizontal","sideBySide","order","groupMargin","tickColor","tickFormatter","formatNumber","locale","hooks","processOffset","stackpercent","enableTicks","undefined","tickGenerator","formatValue","axisLabels","xaxes","axisLabel","axisLabelPadding","yaxes","shadowSize","grid","minBorderMargin","markings","borderWidth","hoverable","selection","mode","detach","datapoint","cumulative","cumulativeCutoff","highlight","dataValue","place_tt","pageX","pageY","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import 'vendor/flot/jquery.flot.js';\nimport 'vendor/flot/jquery.flot.selection.js';\nimport 'vendor/flot/jquery.flot.time.js';\nimport 'vendor/flot/jquery.flot.stack.js';\nimport 'vendor/flot/jquery.flot.stackpercent.js';\nimport 'vendor/flot/jquery.flot.fillbelow.js';\nimport 'vendor/flot/jquery.flot.crosshair.js';\nimport 'vendor/flot/jquery.flot.dashes.js';\n\nimport \"./jquery.flot.axislabels\";\nimport \"./jquery.flot.sideBySideBars\";\n\nimport _ from \"lodash\";\nimport { BasePanelCtrl } from \"./BasePanelCtrl\";\nimport kbn from \"app/core/utils/kbn\";\nimport $ from \"jquery\";\nimport legend from \"./legend\";\n\nexport class FinraBarChartCtrl extends BasePanelCtrl {\n  constructor($scope, $injector, $rootScope, $document, $compile) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n    this.$document = $document;\n    this.$compile = $compile;\n\n    var panelDefaults = {\n      legend: {\n        show: true, // disable/enable legend\n        values: true\n      },\n      tooltip: {\n        showAllDetails: false\n      },\n      links: [],\n      datasource: null,\n      maxDataPoints: 3,\n      interval: null,\n      targets: [{}],\n      cacheTimeout: null,\n      nullPointMode: 'connected',\n      legendTable: false,\n      aliasColors: {},\n      format: 'none',\n      valueName: 'current',\n      stack: false,\n      yaxis: {\n        min: null,\n        max: null,\n        label: null,\n        show: true\n      },\n      xaxis: {\n        min: null,\n        max: null,\n        show: true\n      },\n      decimals: 0,\n      dataspecType: 'map'\n    };\n\n    $scope.$on(\"$destroy\", function () {\n      if ($(\"#drilldown\").length !== 0) {\n        $(\"#drilldown\").remove();\n      }\n    });\n\n    _.defaults(this.panel, panelDefaults);\n    _.defaults(this.panel.legend, panelDefaults.legend);\n    _.defaults(this.panel.xaxis, panelDefaults.xaxis);\n    _.defaults(this.panel.yaxis, panelDefaults.yaxis);\n    _.defaults(this.panel.dd, panelDefaults.dd);\n\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/finra-barchart/options.html');\n    this.unitFormats = kbn.getUnitFormats();\n  }\n\n  setUnitFormat(subItem) {\n    this.panel.format = subItem.value;\n    this.render();\n  }\n\n  onDataError() {\n    console.info(\"Data Error\");\n    this.series = [];\n    this.render();\n  }\n\n  onRender() {\n    this.data = this.parseSeries(this.series);\n  }\n\n  parseSeries(series) {\n    return _.map(this.series, (serie, i) => {\n      return {\n        label: serie.label,\n        data: serie.data,\n        dataReverse: serie.dataReverse,\n        color: this.panel.aliasColors[serie.label] || this.$rootScope.colors[i],\n      };\n    });\n  }\n\n  changeSeriesColor(series, color) {\n    series.color = color;\n    this.panel.aliasColors[series.label] = series.color;\n    this.render();\n  }\n\n\n  onDataReceived(dataList) {\n    this.mapping = this.mappingHandler(dataList.mapping);\n    this.series = this.dataHandler(dataList);\n    this.data = this.parseSeries(this.series);\n    this.stackable = this.stackedData(dataList);\n    this.render();\n  }\n\n  stackedData(data) {\n    return (data.mapping == null || data.mapping.length === 0) ? false : true;\n  }\n\n  mappingHandler(mapping) {\n    return _.map(mapping, (mapping) => {\n      return [mapping.key, mapping.value]\n    })\n  }\n\n  dataHandler(data) {\n    let seriesData = [];\n    _.each(data.series, (curr, i) => {\n      seriesData.push({\n        label: curr.name,\n        data: curr.data,\n        dataReverse: _.map(_.map(curr.data, _.clone), (item) => {\n          _.reverse(item);\n          return item;\n        })\n      })\n    });\n\n    return seriesData;\n  }\n\n  formatValue(value) {\n    var decimalInfo = this.getDecimalsForValue(value);\n    var formatFunc = kbn.valueFormats[this.panel.format];\n    if (formatFunc) {\n      return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n    }\n    return value;\n  }\n\n  tickGenerator(axis) {\n    var ticks = [],\n      start = axis.tickSize * Math.floor(axis.min / axis.tickSize),\n      i = 0,\n      v = Number.NaN,\n      prev,\n      datamaxBuffered = axis.direction == \"y\" ? Math.round(axis.datamax + axis.datamax * 0.05) : axis.datamax;\n\n    do {\n      prev = v;\n      v = start + i * axis.tickSize;\n      ticks.push(v);\n      ++i;\n    } while (v < axis.max && v != prev);\n\n\n\n    // Snap max height to nearest viable tick mark if not manually set\n    if (axis.options.customHeight < 1) { // Check if custom max height specified. Don't change it if so.\n      for (let i = 0; i < ticks.length; i++) {\n        if (datamaxBuffered < ticks[i]) {\n          axis.max = ticks[i];\n          break;\n        }\n      }\n\n    }\n    return ticks;\n  }\n\n\n\n  link(scope, elem, attrs, ctrl) {\n    var data, panel, mapping, stackable;\n    var firstRender = 0;\n\n    elem = elem.find('.barchart-panel');\n    var $tooltip = $('<div id=\"tooltip\">');\n    ctrl.events.on('render', function () {\n      render();\n      ctrl.renderingCompleted();\n    });\n\n    function setElementHeight() {\n      try {\n        var height = ctrl.height || panel.height || ctrl.row.height;\n        if (_.isString(height)) {\n          height = parseInt(height.replace('px', ''), 10);\n        }\n\n        height -= 5; // padding\n        height -= panel.title ? 24 : 9; // subtract panel title bar\n\n        elem.css('height', height + 'px');\n\n        return true;\n      } catch (e) { // IE throws errors sometimes\n        return false;\n      }\n    }\n\n    function processOffsetHook(plot, gridMargin) {\n      var left = panel.yaxis;\n      var right = panel.yaxis;\n      if (left.show && left.label) { gridMargin.left = 20; }\n      if (right.show && right.label) { gridMargin.right = 20; }\n    }\n\n    function addBarChart() {\n      var width = elem.width();\n      var height = elem.height();\n\n      var size = Math.min(width, height);\n\n      var plotCanvas = $('<div></div>');\n\n      if (ctrl.panel.legendRight && firstRender < 2) {\n        var plotCss = {\n          top: '10px',\n          margin: 'auto',\n          position: 'relative',\n          height: height - 20 + 'px',\n          width: width - 200 + 'px'\n        };\n        firstRender = firstRender + 1;\n      } else {\n        var plotCss = {\n          top: '10px',\n          margin: 'auto',\n          position: 'relative',\n          height: (size - 20) + 'px'\n        };\n      }\n      plotCanvas.css(plotCss);\n\n      if (ctrl.panel.dd.hasRawData) {\n        plotCanvas.bind(\"plotclick\", function (event, pos, item) {\n          if ($(\"#drilldown\").length !== 0) {\n            $(\"#drilldown\").remove();\n          }\n          var $drilldown = $('<div id=\"drilldown\">');\n          if (item) {\n            var newScope = scope.$new();\n            newScope.label = ctrl.panel.label;\n            newScope.title = ctrl.panel.title;\n            var seriesName = _.find(mapping, o => { return o[0] === item.dataIndex + 1; });\n            seriesName = seriesName ? seriesName[1] : null;\n            var body = ctrl.$compile(\"<div id='drilldownPane' finra-drilldown \" +\n              \"title='\" + ctrl.panel.title + \"' \" +\n              \"label='\" + item.series.label + \"' \" +\n              \"series='\" + seriesName + \"' \" +\n              \"endpoint='\" + ctrl.panel.dd.rawDataAlias + \"' \" +\n              \"drilldown-config='ctrl.panel.dd' \" +\n              \"datasource='ctrl.datasource'></div>\")(scope);\n            $drilldown.html(body).appendTo(ctrl.$document[0].body);\n          }\n        });\n      }\n\n      var $panelContainer = elem.parents('.panel-container');\n      var backgroundColor = $panelContainer.css('background-color');\n\n      elem.html(plotCanvas);\n\n      var plotSeries = [];\n\n      var barLabels = [];\n      var barLabelsReverse = [];\n\n      _.map(data, (dataItem, i) => {\n        plotSeries.push({\n          label: dataItem.label,\n          data: panel.flip ? dataItem.dataReverse : dataItem.data,\n          clickable: true,\n          color: dataItem.color,\n          bars: {\n            show: true,\n            align: 'center',\n            fill: 1,\n            barWidth: 0.5,\n            zero: true,\n            lineWidth: 0,\n            horizontal: panel.flip,\n            sideBySide: {\n              order: !panel.stack ? i : null,\n              groupMargin: 0.125,\n              margin: 0.01\n            }\n          },\n          yaxis: {\n            tickColor: \"#5E5E5E\",\n            color: \"#FFFFFF\",\n          },\n          xaxis: {\n            tickColor: \"#5E5E5E\",\n            tickFormatter: function (v, axis) {\n              return $.formatNumber(v, { format: \"#,###\", locale: \"us\" });\n            },\n            color: \"#FFFFFF\"\n          }\n        });\n\n        barLabels.push([dataItem.data[0][0], dataItem.label]);\n        barLabelsReverse.push([dataItem.dataReverse[0][0], dataItem.label]);\n      });\n\n      var options = {\n        hooks: {\n          processOffset: [processOffsetHook],\n        },\n        legend: {\n          show: false\n        },\n        series: {\n          stackpercent: false,\n          stack: !panel.stack ? null : true,\n          stackable: stackable,\n          bars: {sideBySide: {groupMargin: 0}}\n        },\n        xaxis: {\n          // min: panel.xaxis.min,\n          max: panel.flip ? panel.xaxis.max < 1 ? null : panel.xaxis.max : null,\n          customHeight: panel.xaxis.max >= 1 ? panel.xaxis.max : null,\n          show: panel.xaxis.show,\n          ticks: !panel.flip && panel.enableTicks ? (mapping === undefined ? barLabels : (mapping.length !== 0 ? mapping : barLabels)) : ctrl.tickGenerator,\n          tickFormatter: (!panel.flip) ? null : function (v, axis) { return ctrl.formatValue(v); }\n        },\n        yaxis: {\n          // min: panel.yaxis.min,\n          max: panel.flip ? null : panel.yaxis.max < 1 ? null : panel.yaxis.max,\n          customHeight: panel.yaxis.max >= 1 ? panel.yaxis.max : null,\n          show: panel.yaxis.show,\n          ticks: panel.flip && panel.enableTicks ? (mapping === undefined ? barLabels : (mapping.length !== 0 ? mapping : barLabels)) : ctrl.tickGenerator,\n          tickFormatter: (!panel.flip) ? function (v, axis) { return ctrl.formatValue(v); } : null\n        },\n        axisLabels: {\n          show: true\n        },\n        xaxes: [{\n          axisLabel: panel.xaxis.label,\n          axisLabelPadding: 20\n        }],\n        yaxes: [{\n          position: 'left',\n          axisLabel: panel.yaxis.label,\n          axisLabelPadding: 20\n        }],\n\n        shadowSize: 0,\n        grid: {\n          minBorderMargin: 0,\n          markings: [],\n          backgroundColor: backgroundColor,\n          borderWidth: 0.25,\n          clickable: true,\n          hoverable: true,\n          color: '#c8c8c8',\n          margin: { left: 0, right: 0 },\n        },\n        selection: {\n          mode: \"x\",\n          color: '#666'\n        }\n      };\n\n      $.plot(plotCanvas, plotSeries, options);\n      plotCanvas.bind(\"plothover\", function (event, pos, item) {\n        if (!item) {\n          $tooltip.detach();\n          return;\n        }\n\n        var body, value;\n\n\n        if (panel.flip) {\n          value = item.datapoint[0] - item.datapoint[2];\n        } else {\n          value = item.datapoint[1] - item.datapoint[2];\n        }\n\n        var seriesName = _.find(mapping, o => { return o[0] === item.dataIndex + 1; });\n        seriesName = seriesName ? seriesName[1] : null;\n\n        if (panel.tooltip.showAllDetails && stackable && panel.stack) {\n\n          body = '<div class=\"graph-tooltip\" style=\"background-color: inherit\">';\n          body +=   '<div class=\"graph-tooltip-list-item\">';\n          body +=     '<div class=\"graph-tooltip-time\">'+seriesName+'</div>';\n          body +=   '</div>';\n\n          var cumulative = 0;\n          var cumulativeCutoff = 0;\n          for (var i=data.length-1; i>=0; i--) {\n            var highlight = '';\n            var dataValue = data[i].data[item.dataIndex][1];\n            if (data[i].label === item.series.label) {\n              highlight = 'graph-tooltip-list-item--highlight';\n              cumulativeCutoff = i;\n            }\n            if (i <= cumulativeCutoff) cumulative += dataValue;\n\n            body += '<div class=\"graph-tooltip-list-item '+highlight+'\">';\n            body +=   data[i].label+': '+dataValue;\n            body += '</div>';\n\n          }\n\n          body +=   '<div class=\"graph-tooltip-list-item\">';\n          body +=     'Cumulative Total: '+cumulative;\n          body +=   '</div>';\n\n          body += '</div>';\n\n        } else {\n\n          body = '<div class=\"graph-tooltip\" style=\"background-color: inherit\">';\n          if (seriesName != null) {\n            body += '<div class=\"graph-tooltip-list-item\">';\n            body +=   '<div class=\"graph-tooltip-time\">';\n            body +=     seriesName;\n            body +=   '</div>';\n            body += '</div>';\n          }\n          body +=   '<div class=\"graph-tooltip-list-item--highlight\">';\n          body +=     item.series.label+': '+value;\n          body +=   '</div>';\n          body += '</div>';\n        }\n\n          $tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n      });\n    }\n\n    function render() {\n      if (!ctrl.data) {\n        return;\n      }\n\n      data = ctrl.data;\n      panel = ctrl.panel;\n      mapping = ctrl.mapping;\n      stackable = ctrl.stackable;\n\n      if (setElementHeight()) {\n        addBarChart();\n      }\n    }\n  }\n}\n\nFinraBarChartCtrl.templateUrl = 'module.html';\n\nexport {\n  FinraBarChartCtrl as PanelCtrl\n};\n\n"]}