{"version":3,"sources":["../src/legend.js"],"names":["angular","_","$","module","directive","popoverSrv","$timeout","link","scope","elem","$container","firstRender","ctrl","panel","data","seriesList","i","events","on","render","getSeriesIndexForElement","el","parents","openColorSelector","e","target","length","currentTarget","find","index","series","show","element","position","template","openOn","model","toggleAxis","colorSelected","color","changeSeriesColor","append","empty","tableLayout","legendTable","legend","values","toggleClass","header","hideEmpty","allIsNull","html","label"],"mappings":"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","file":"legend.js","sourcesContent":["import angular from 'angular';\nimport _ from  'lodash';\nimport $ from  'jquery';\n//import 'jquery.flot';\n//import 'jquery.flot.time';\nimport 'vendor/flot/jquery.flot.js';\nimport 'vendor/flot/jquery.flot.time.js';\n\nangular.module('grafana.directives').directive('finraBarchartLegend', function(popoverSrv, $timeout) {\n  return {\n    link: function(scope, elem) {\n      var $container = $('<section class=\"graph-legend\"></section>');\n      var firstRender = true;\n      var ctrl = scope.ctrl;\n      var panel = ctrl.panel;\n      var data;\n      var seriesList;\n      var i;\n\n      ctrl.events.on('render', function() {\n        data = ctrl.data;\n        if (data) {\n\n          render();\n        }\n      });\n\n      function getSeriesIndexForElement(el) {\n        return el.parents('[data-series-index]').data('series-index');\n      }\n\n      function openColorSelector(e) {\n        // if we clicked inside poup container ignore click\n        if ($(e.target).parents('.popover').length) {\n          return;\n        }\n\n        var el = $(e.currentTarget).find('.fa-minus');\n        var index = getSeriesIndexForElement(el);\n        var series = seriesList[index];\n        $timeout(function() {\n          popoverSrv.show({\n            element: el[0],\n            position: 'bottom center',\n            template: '<gf-color-picker></gf-color-picker>',\n            openOn: 'hover',\n            model: {\n              series: false,\n              toggleAxis: function() {\n                ctrl.toggleAxis(series);\n              },\n              colorSelected: function(color) {\n                ctrl.changeSeriesColor(series, color);\n              }\n            },\n          });\n        });\n      }\n      \n      function render() {\n        if (firstRender) {\n          $container.on('click', '.graph-legend-icon', openColorSelector);\n          elem.append($container);\n          firstRender = false;\n        }\n\n        seriesList = data;\n\n        $container.empty();\n\n        var tableLayout = panel.legendTable && panel.legend.values;\n\n        $container.toggleClass('graph-legend-table', tableLayout);\n\n        if (tableLayout) {\n\n          var header = '<tr><th colspan=\"2\" style=\"text-align:left\"></th>';\n          if (panel.legend.values) {\n            header += '<th class=\"pointer\"></th>';\n          }\n          header += '</tr>';\n          $container.append($(header));\n        }\n\n        for (i = 0; i < seriesList.length; i++) {\n          var series = seriesList[i];\n          // ignore empty series\n\n          if (panel.legend.hideEmpty && series.allIsNull) {\n              continue;\n          }\n\n          var html = '<div class=\"graph-legend-series';\n          html += '\" data-series-index=\"' + i + '\">';\n          html += '<span class=\"graph-legend-icon no-pointer\">';\n          html += '<i class=\"fa fa-minus\" style=\"color:' + series.color + '\"></i>';\n          html += '</span>';\n\n          html += '<span class=\"graph-legend-alias no-pointer\">';\n          html += '<a class=\"no-pointer\">' + series.label + '</a>';\n          html += '</span>';\n\n          html += '</div>';\n          $container.append($(html));\n        }\n      }\n    }\n  };\n});\n\n\n"]}