{"version":3,"sources":["../src/BasePanelTabCtrl.js"],"names":["queryTabDirective","restrict","scope","templateUrl","controller","BasePanelTabCtrl","_","kbn","vm","$scope","datasourceSrv","panelCtrl","ctrl","panel","dashboard","refreshMetadata","nextRefId","getNextQueryLetter","alias","updateMetadata","get","then","dataservice","getSources","dataspecType","sources","addQuery","isNew","refresh","targets","scopedVars","metrics","getMetrics","dd","hasRawData","rawData","rawDataAlias","removeAllQueries","namespace"],"mappings":";;;;;;;;;;;;;AA+EO,aAASA,iBAAT,GAA6B;AAChC;;AACA,eAAO;AACHC,sBAAU,GADP;AAEHC,mBAAO,IAFJ;AAGHC,yBAAa,2BAHV;AAIHC,wBAAYC;AAJT,SAAP;AAMH;;iCAReL,iB;;;;AA/ETM,a;;AACAC,e;;;;;;;;;;;;;;;;;;;;;AAGHC,c;;wCACSH,gB;AAET,0CAAYI,MAAZ,EAAoBC,aAApB,EAAmC;AAAA;;AAC/B,yBAAKC,SAAL,GAAiBF,OAAOG,IAAxB;AACAH,2BAAOG,IAAP,GAAc,IAAd;;AAEA,yBAAKC,KAAL,GAAa,KAAKF,SAAL,CAAeE,KAA5B;AACA,yBAAKC,SAAL,GAAiB,KAAKH,SAAL,CAAeG,SAAhC;AACA,yBAAKJ,aAAL,GAAqBA,aAArB;AACAF,yBAAG,IAAH;AACA,yBAAKO,eAAL;AACA,yBAAKJ,SAAL,CAAeK,SAAf,GAA2B,KAAKF,SAAL,CAAeG,kBAAf,CAAkC,KAAKJ,KAAvC,CAA3B;;AAEA,wBAAG,KAAKA,KAAL,CAAWK,KAAd,EAAoB;AAChB,6BAAKC,cAAL,CAAoB,KAAKN,KAAL,CAAWK,KAA/B;AACH;AACJ;;;;sDAEgB;AACb,6BAAKR,aAAL,CAAmBU,GAAnB,GAAyBC,IAAzB,CAA8B,UAASC,WAAT,EAAqB;AAC/CA,wCAAYC,UAAZ,CAAuBf,GAAGK,KAAH,CAASW,YAAhC,EAA8CH,IAA9C,CAAmD,UAASI,OAAT,EAAiB;AAChEjB,mCAAGK,KAAH,CAASY,OAAT,GAAmBA,OAAnB;AACH,6BAFD;AAGH,yBAJD;AAMH;;;+CAEU;AACP,6BAAKd,SAAL,CAAee,QAAf,CAAwB,EAACC,OAAO,IAAR,EAAxB;AACH;;;mDAGc;AACX,6BAAKhB,SAAL,CAAeiB,OAAf;AACH;;;uDAEiB;AACd,6BAAKf,KAAL,CAAWgB,OAAX,GAAqB,CAAC,EAAD,CAArB;AACA,6BAAKhB,KAAL,CAAWiB,UAAX,GAAwB,EAAxB;AACH;;;mDAEcZ,K,EAAM;AACjBV,2BAAGE,aAAH,CAAiBU,GAAjB,GAAuBC,IAAvB,CAA4B,UAASC,WAAT,EAAqB;AAC7CA,wCAAYH,cAAZ,CAA2BD,KAA3B;AACH,yBAFD;AAGH;;;yDAEoBA,K,EAAM;AACvB,4BAAGA,KAAH,EAAU;AACN,iCAAKC,cAAL,CAAoBD,KAApB;AACH;AACDV,2BAAGE,aAAH,CAAiBU,GAAjB,GAAuBC,IAAvB,CAA4B,UAASC,WAAT,EAAqB;AAC7C,gCAAIS,UAAUT,YAAYU,UAAZ,EAAd;AACAxB,+BAAGK,KAAH,CAASoB,EAAT,GAAc,EAAd;AACAzB,+BAAGK,KAAH,CAASoB,EAAT,CAAYC,UAAZ,GAAyBH,QAAQI,OAAjC;AACA3B,+BAAGK,KAAH,CAASoB,EAAT,CAAYG,YAAZ,GAA2BL,QAAQK,YAAnC;AACH,yBALD;;AAQA,6BAAKC,gBAAL;AACH;;;+CAEUC,S,EAAU;AACjB,4BAAG,CAAC9B,GAAGK,KAAH,CAASY,OAAb,EAAqB;AACjB,iCAAKV,eAAL;AACH;AACD,+BAAOP,GAAGK,KAAH,CAASY,OAAT,CAAiBa,SAAjB,CAAP;AACH","file":"BasePanelTabCtrl.js","sourcesContent":["import _ from \"lodash\";\nimport kbn from \"app/core/utils/kbn\";\nimport './query-tab.css!'\n\nlet vm;\nexport class BasePanelTabCtrl  {\n\n    constructor($scope, datasourceSrv) {\n        this.panelCtrl = $scope.ctrl;\n        $scope.ctrl = this;\n\n        this.panel = this.panelCtrl.panel;\n        this.dashboard = this.panelCtrl.dashboard;\n        this.datasourceSrv = datasourceSrv;\n        vm=this;\n        this.refreshMetadata();\n        this.panelCtrl.nextRefId = this.dashboard.getNextQueryLetter(this.panel);\n        \n        if(this.panel.alias){\n            this.updateMetadata(this.panel.alias)\n        }\n    }\n    \n    refreshMetadata(){\n        this.datasourceSrv.get().then(function(dataservice){\n            dataservice.getSources(vm.panel.dataspecType).then(function(sources){\n                vm.panel.sources = sources\n            })\n        });\n        \n    }\n\n    addQuery() {\n        this.panelCtrl.addQuery({isNew: true});\n    }\n\n\n    refreshPanel() {\n        this.panelCtrl.refresh();\n    }\n\n    removeAllQueries(){\n        this.panel.targets = [{}]\n        this.panel.scopedVars = [];\n    }\n\n    updateMetadata(alias){\n        vm.datasourceSrv.get().then(function(dataservice){\n            dataservice.updateMetadata(alias)\n        });\n    }\n\n    refreshParamDropdown(alias){\n        if(alias) {\n            this.updateMetadata(alias);\n        }\n        vm.datasourceSrv.get().then(function(dataservice){\n            var metrics = dataservice.getMetrics();\n            vm.panel.dd = {};\n            vm.panel.dd.hasRawData = metrics.rawData;\n            vm.panel.dd.rawDataAlias = metrics.rawDataAlias;\n        });\n        \n        \n        this.removeAllQueries();\n    }\n\n    getAliases(namespace){\n        if(!vm.panel.sources){\n            this.refreshMetadata();\n        }\n        return vm.panel.sources[namespace]\n    }\n\n\n\n\n}\n\nexport function queryTabDirective() {\n    'use strict';\n    return {\n        restrict: 'E',\n        scope: true,\n        templateUrl: './partials/query_tab.html',\n        controller: BasePanelTabCtrl\n    };\n}"]}